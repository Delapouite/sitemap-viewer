<!DOCTYPE html>
<html>
<head>
	<title>Sitemap Viewer</title>
	<style>
		body {
			font-family: sans-serif;
			display: flex;
		}
		body > ol {
			flex: 1;
			justify-content: center
		}
	</style>
	<script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
	<script src="http://cdnjs.cloudflare.com/ajax/libs/lodash.js/1.3.1/lodash.min.js"></script>
	<script src="/js/vendor/uri.js"></script>
</head>
<body>
	<script>
	var junks = [
		'https://developer.mozilla.org/fr/docs/C404',
		'https://developer.mozilla.org/fr/docs/davidwalshtestdoc',
		'https://developer.mozilla.org/fr/docs/My_Chrome_Oven',
		'https://developer.mozilla.org/fr/docs/Vulgarisation_XUL/Godvicien',
		'https://developer.mozilla.org/fr/docs/lisandru',
		'https://developer.mozilla.org/fr/docs/Pr%C3%A9cis_CSS_2',
		'https://developer.mozilla.org/fr/docs/Test'
	];
	function display(country) {
		$.ajax({
			url: '/sitemaps/' + country + '.xml',
		}).done(function(xml) {
			// order paths and locs by alpha
			var locs = {},
				lastMods = {};
			$(xml).find('url').each(function() {
				var loc = $(this).find('loc').text();
				var uri = new URI(loc);
				var path = uri.directory(true);
				if (!locs[path]) {
					locs[path] = [];
				}
				locs[path].push(loc);
				lastMods[loc] = $(this).find('lastmod').text();
			});

			var paths = _.sortBy(Object.keys(locs));

			// country header
			var table = $('<table></table>');
			table.append($('<tr><th colspan="7"><h2>' + country + ' : ' + $(xml).find('url').length + ' urls' + '</h2></th></tr>'));
			table.append($('<tr><th>lastmod</th><th>URI</th><th>Tags</th><th>Last updated</th><th>Last editor</th><th>Last dump</th><th>Junk?</th></tr>'));

			paths.forEach(function(path) {
				// path header
				table.append($('<tr><td colspan="7"><h3>' + path + '</h3></td></tr>'));

				var orderedLocs = _.sortBy(locs[path]);
				orderedLocs.forEach(function(loc) {
					table.append('<tr><td>' + lastMods[loc] + '</td><td><a href="' + loc + '">' + (new URI(loc)).filename(true) + '</a></td><td></td><td></td><td></td><td></td><td></td></tr>');
				});
			});
			$('body').append(table);
		});
	}
	display('fr');
	// display('en-US');
	</script>
</body>
</html>